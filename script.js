const scheduleData = {
  "monday": [
    {
      "time": "13:05",
      "week": "all",
      "course": "",
      "title": "",
      "teacher": "",
      "location": "",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "14:40",
      "week": "all",
      "course": "lection",
      "title": "Новітня Історія України",
      "teacher": "Вербовий О.Ф.",
      "location": "Онлайн",
      "additionalInfo": "https://meet.google.com/yao-yrwr-heg",
      "alternative": false
    },
    {
      "time": "16:20",
      "week": "all",
      "course": "lection",
      "title": "Історія політики країн Заходу щодо України",
      "teacher": "Машевський О.П.",
      "location": "Онлайн",
      "additionalInfo": "https://knu-ua.zoom.us/j/88035974768?pwd=NWxnZll2YkxiWkowaTZ3Y0lqVTZhdz09",
      "alternative": false
    },
    {
      "time": "17:55",
      "week": "all",
      "course": "lection",
      "title": "Історія раннього Нового часу",
      "teacher": "Пількевич А. Л.",
      "location": "Онлайн",
      "additionalInfo": "https://us02web.zoom.us/j/71399386454?pwd=RitDZGxhUVpWcHFpRkVUMU9ER0J3QT09",
      "alternative": false
    },
    // Америка
    {
      "time": "13:05",
      "week": "all",
      "course": "",
      "title": "",
      "teacher": "",
      "location": "",
      "additionalInfo": "",
      "alternative": true
    },
    {
      "time": "14:40",
      "week": "all",
      "course": "lection",
      "title": "Новітня Історія України",
      "teacher": "Вербовий О.Ф.",
      "location": "Онлайн",
      "additionalInfo": "https://meet.google.com/yao-yrwr-heg",
      "alternative": true
    },
    {
      "time": "16:20",
      "week": "all",
      "course": "lection",
      "title": "Історичні витоки політичної культури американського суспільства",
      "teacher": "Корнієнко А.Ю.",
      "location": "Онлайн",
      "additionalInfo": "https://us06web.zoom.us/j/87293187730?pwd=ZRmcbu2gX4CrXGJU4SnEHYQHuQknax.1Meeting ID: 872 9318 7730Passcode: 076338",
      "alternative": true
    },
    {
      "time": "17:55",
      "week": "all",
      "course": "lection",
      "title": "Історія раннього Нового часу",
      "teacher": "Пількевич А. Л.",
      "location": "Онлайн",
      "additionalInfo": "https://us02web.zoom.us/j/71399386454?pwd=RitDZGxhUVpWcHFpRkVUMU9ER0J3QT09",
      "alternative": true
    }
  ],
  "tuesday": [
    {
      "time": "13:05",
      "week": "all", 
      "course": "",
      "title": "",
      "teacher": "",
      "location": "",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "14:40",
      "week": "all",
      "course": "language",
      "title": "Англійська / Французька / Німецька / Іспанська",
      "teacher": "Шевченко О.Ф / Рижова І.А. / Симканич О.В. / Невинна Ю.П.",
      "location": "153 / 456 / Онлайн / 452 ауд.",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "16:20",
      "week": "all",
      "course": "seminar",
      "title": "Історія раннього Нового часу",
      "teacher": "Грегуль А. Ю",
      "location": "453 аудиторія",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "17:55",
      "week": "all",
      "course": "seminar",
      "title": "Історія Східної Європи та Росії",
      "teacher": "Гуменний С. Л.",
      "location": "438 аудиторія",
      "additionalInfo": "",
      "alternative": false
    },
    // Америка
    {
      "time": "13:05",
      "week": "all", 
      "course": "",
      "title": "",
      "teacher": "",
      "location": "",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "14:40",
      "week": "all",
      "course": "language",
      "title": "Англійська / Французька / Німецька / Іспанська",
      "teacher": "Шевченко О.Ф / Рижова І.А. / Симканич О.В. / Невинна Ю.П.",
      "location": "153 / 456 / Онлайн / 452 ауд.",
      "additionalInfo": "",
      "alternative": true
    },
    {
      "time": "16:20",
      "week": "all",
      "course": "seminar",
      "title": "Історія раннього Нового часу",
      "teacher": "Грегуль А. Ю",
      "location": "453 аудиторія",
      "additionalInfo": "",
      "alternative": true
    },
    {
      "time": "17:55",
      "week": "all",
      "course": "seminar",
      "title": "Історія Східної Європи та Росії",
      "teacher": "Гуменний С. Л.",
      "location": "438 аудиторія",
      "additionalInfo": "",
      "alternative": true
    },
  ],
  "wednesday": [
    {
      "time": "13:05",
      "week": "all",
      "course": "",
      "title": "",
      "teacher": "",
      "location": "",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "14:40",
      "week": "all",
      "course": "lection",
      "title": "Історія Східної Європи та Росії",
      "teacher": "Мордвінцев В. М.",
      "location": "Онлайн; 10:00",
      "additionalInfo": "https://zoom.us/j/5169999552?pwd=UENVOXlJYm9hcWRQTDFnd3ZMemgzdz09",
      "alternative": false
    },
    {
      "time": "16:20",
      "week": "all",
      "course": "seminar",
      "title": "Історія політичного устрою країн Західної Європи ",
      "teacher": "Іванов О. Ф.",
      "location": "451 аудиторія",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "17:55",
      "week": "all",
      "course": "language",
      "title": "Англійська / Французька / Німецька / Іспанська",
      "teacher": "Шевченко О.Ф / Рижова І.А. / Симканич О.В. / Невинна Ю.П.",
      "location": "153 / 456 / Онлайн / 452 ауд.",
      "additionalInfo": "",
      "alternative": false
    },
    // Америка
    {
      "time": "13:05",
      "week": "all",
      "course": "",
      "title": "",
      "teacher": "",
      "location": "",
      "additionalInfo": "",
      "alternative": true
    },
    {
      "time": "14:40",
      "week": "all",
      "course": "lection",
      "title": "Історія Східної Європи та Росії",
      "teacher": "Мордвінцев В. М.",
      "location": "Онлайн; 10:00",
      "additionalInfo": "https://zoom.us/j/5169999552?pwd=UENVOXlJYm9hcWRQTDFnd3ZMemgzdz09",
      "alternative": true
    },
    {
      "time": "16:20",
      "week": "all",
      "course": "seminar",
      "title": "Історія Канади",
      "teacher": "Сухобокова О.О.",
      "location": "448 аудиторія",
      "additionalInfo": "",
      "alternative": true
    },
    {
      "time": "17:55",
      "week": "all",
      "course": "language",
      "title": "Англійська / Французька / Німецька / Іспанська",
      "teacher": "Шевченко О.Ф / Рижова І.А. / Симканич О.В. / Невинна Ю.П.",
      "location": "153 / 456 / Онлайн / 452 ауд.",
      "additionalInfo": "",
      "alternative": true
    },
  ],
  "thursday": [
    {
      "time": "13:05",
      "week": "lower",
      "course": "lection",
      "title": "Історія політичного устрою країн Західної Європи ",
      "teacher": "Іванов О. Ф.",
      "location": "451 аудиторія",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "13:05",
      "week": "upper",
      "course": "",
      "title": "",
      "teacher": "",
      "location": "",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "14:40",
      "week": "upper",
      "course": "seminar",
      "title": "Історія політики країн Заходу щодо України",
      "teacher": "Машевський О.П.",
      "location": "460 аудиторія",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "16:20",
      "week": "upper",
      "course": "seminar",
      "title": "Новітня історія України",
      "teacher": "Шкабко С. І.",
      "location": "452 аудиторія",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "17:55",
      "week": "all",
      "course": "language",
      "title": "Англійська / Французька / Німецька / Іспанська",
      "teacher": "Шевченко О.Ф / Рижова І.А. / Симканич О.В. / Невинна Ю.П.",
      "location": "153 / 456 / Онлайн / 452 ауд.",
      "additionalInfo": "",
      "alternative": false
    },
     // Америка
    {
      "time": "13:05",
      "week": "lower",
      "course": "lection",
      "title": "Історія Канади",
      "teacher": "Сухобокова О.О.",
      "location": "448 аудиторія",
      "additionalInfo": "",
      "alternative": true
    },
    {
      "time": "14:40",
      "week": "upper",
      "course": "seminar",
      "title": "Історичні витоки політичної культури американського суспільства",
      "teacher": "Корнієнко А.Ю.",
      "location": "448 аудиторія",
      "additionalInfo": "",
      "alternative": true
    },
    {
      "time": "16:20",
      "week": "upper",
      "course": "seminar",
      "title": "Новітня історія України",
      "teacher": "Шкабко С. І.",
      "location": "452 аудиторія",
      "additionalInfo": "",
      "alternative": true
    },
    {
      "time": "17:55",
      "week": "all",
      "course": "language",
      "title": "Англійська / Французька / Німецька / Іспанська",
      "teacher": "Шевченко О.Ф / Рижова І.А. / Симканич О.В. / Невинна Ю.П.",
      "location": "153 / 456 / Онлайн / 452 ауд.",
      "additionalInfo": "",
      "alternative": true
    },

  ],
  "friday": [
    {
      "time": "13:05",
      "week": "all",
      "course": "",
      "title": "",
      "teacher": "",
      "location": "",
      "additionalInfo": "",
      "alternative": false
    },
    {
      "time": "14:40",
      "week": "all",
      "course": "lection",
      "title": "Дисципліна вільного вибору",
      "teacher": "",
      "location": "Онлайн",
      "additionalInfo": "https://telegra.ph/Discipl%D1%96na-v%D1%96lnogo-viboru-studenta-03-08",
      "alternative": false
    },
    //
    {
      "time": "13:05",
      "week": "all",
      "course": "",
      "title": "",
      "teacher": "",
      "location": "",
      "additionalInfo": "",
      "alternative": true
    },
    {
      "time": "14:40",
      "week": "all",
      "course": "lection",
      "title": "Дисципліна вільного вибору",
      "teacher": "",
      "location": "Онлайн",
      "additionalInfo": "https://telegra.ph/Discipl%D1%96na-v%D1%96lnogo-viboru-studenta-03-08",
      "alternative": true
    },
  ],

  };

const parameterIcons = {
  "teacher": "<i class='fas fa-user-tie'></i>&nbsp;",
  "location": "<i class='fas fa-map-marker-alt'></i>&nbsp;"
};

const courseNames = {
  "lection": "Лекція",
  "seminar": "Семінар",
  "language": "Мова"
};

const days = document.querySelectorAll('.day');
const scheduleContent = document.querySelectorAll('.schedule-content');
const today = new Date().getDay();
let currentDay = '';
let currentWeek = 'upper';
let isAlternativeMode = false;
const lessonTimes = ["13:05", "14:40", "16:20", "17:55"];
const switchBtn = document.getElementById('switch');
const nightElements = document.querySelectorAll('.container, body');

switchBtn.addEventListener('change', function() {
    if (this.checked) {
        nightElements.forEach(element => {
            element.classList.add('night');
        });
    } else {
        nightElements.forEach(element => {
            element.classList.remove('night');
        });
    }
});

function openInDefaultBrowser(url) {
    if (window.location.href.startsWith('file://')) {
        window.open(url, '_system');
    } else {
        window.location.href = url;
    }
}

function displaySchedule(day) {
    scheduleContent.forEach(content => {
        content.innerHTML = '';
        content.style.display = 'none';
    });

    const dayData = scheduleData[day];
    if (dayData) {
        dayData.forEach(timeSlotData => {
            if ((day !== 'sunday' && day !== 'saturday') && ((timeSlotData.week === 'all' || timeSlotData.week === currentWeek) && ((!isAlternativeMode && !timeSlotData.alternative) || (isAlternativeMode && timeSlotData.alternative)))) {
                if (timeSlotData.course) {
                    const classElement = document.createElement('div');
                    classElement.classList.add('class');
                    const courseTitle = document.createElement('strong');
                    courseTitle.textContent = courseNames[timeSlotData.course];
                    courseTitle.dataset.course = timeSlotData.course;
                    classElement.appendChild(courseTitle);
                    const title = document.createElement('p');
                    const titleText = document.createElement('span');
                    titleText.textContent = timeSlotData.title;
                    title.appendChild(titleText);
                    titleText.style.fontWeight = 'bold';
                    classElement.appendChild(title);
                    Object.keys(parameterIcons).forEach(parameter => {
                        if (timeSlotData[parameter]) {
                            const icon = document.createElement('span');
                            icon.innerHTML = parameterIcons[parameter];
                            const parameterValue = document.createElement('span');
                            parameterValue.textContent = timeSlotData[parameter];
                            const parameterElement = document.createElement('p');
                            parameterElement.appendChild(icon);
                            parameterElement.appendChild(parameterValue);
                            if (parameter === 'location' || parameter === 'additionalInfo') {
                                parameterElement.style.marginBottom = '20px';
                            }
                            classElement.appendChild(parameterElement);
                        }
                    });
                    if (timeSlotData.additionalInfo && timeSlotData.additionalInfo.includes('https')) {
                        const additionalInfo = document.createElement('button');
                        additionalInfo.textContent = 'Посилання';
                        additionalInfo.classList.add('additional-info-button');
                        additionalInfo.addEventListener('click', () => openInDefaultBrowser(timeSlotData.additionalInfo));
                        classElement.appendChild(additionalInfo);
                        title.style.marginBottom = '10px';
                    }

                    const lessonIndex = lessonTimes.indexOf(timeSlotData.time);
                    if (lessonIndex !== -1) {
                        const timeBar = document.querySelectorAll('.time-bar')[lessonIndex];
                        if (isCurrentTimeSlot(timeSlotData.time)) {
                            timeBar.classList.add('current-time');
                        }
                        scheduleContent[lessonIndex].appendChild(classElement);
                        scheduleContent[lessonIndex].style.display = 'flex';
                    }
                }
            }
        });

        lessonTimes.forEach((time, index) => {
            const timeBar = document.querySelectorAll('.time-bar')[index];
            if (scheduleContent[index].children.length === 0) {
                timeBar.style.display = 'none';
            } else {
                timeBar.style.display = 'block';
            }
        });
    } else {
        scheduleContent.forEach(content => {
            content.style.display = 'none';
        });
    }
}

function isCurrentTimeSlot(time) {
    const currentTime = new Date();
    const hours = currentTime.getHours();
    const minutes = currentTime.getMinutes();
    const currentTimeString = `${hours < 10 ? '0' : ''}${hours}:${minutes < 10 ? '0' : ''}${minutes}`;
    return currentTimeString === time;
}

days.forEach(day => {
    day.addEventListener('click', () => {
        days.forEach(d => d.classList.remove('active'));
        day.classList.add('active');
        currentDay = day.dataset.day;
        displaySchedule(currentDay);
    });
});

document.getElementById('upper-week').addEventListener('click', () => {
    currentWeek = 'upper';
    scheduleContent.forEach(content => content.innerHTML = '');
    displaySchedule(currentDay);
    document.getElementById('upper-week').classList.add('active');
    document.getElementById('lower-week').classList.remove('active');
});

document.getElementById('lower-week').addEventListener('click', () => {
    currentWeek = 'lower';
    scheduleContent.forEach(content => content.innerHTML = '');
    displaySchedule(currentDay);
    document.getElementById('lower-week').classList.add('active');
    document.getElementById('upper-week').classList.remove('active');
});

document.getElementById('normal-mode').addEventListener('click', () => {
    if (isAlternativeMode) {
        isAlternativeMode = false;
        displaySchedule(currentDay);
        document.getElementById('normal-mode').classList.add('active');
        document.getElementById('alternative-mode').classList.remove('active');
    }
});

document.getElementById('alternative-mode').addEventListener('click', () => {
    if (!isAlternativeMode) {
        isAlternativeMode = true;
        displaySchedule(currentDay);
        document.getElementById('alternative-mode').classList.add('active');
        document.getElementById('normal-mode').classList.remove('active');
    }
});

const resetActiveDay = () => {
    days.forEach(d => d.classList.remove('active'));
};

const upperWeekButton = document.getElementById('upper-week');
const lowerWeekButton = document.getElementById('lower-week');

upperWeekButton.addEventListener('click', () => {
    if (currentWeek !== 'upper') {
        currentWeek = 'upper';
        scheduleContent.forEach(content => content.innerHTML = '');
        displaySchedule(currentDay);
        upperWeekButton.classList.add('active');
        lowerWeekButton.classList.remove('active');
    }
});

lowerWeekButton.addEventListener('click', () => {
    if (currentWeek !== 'lower') {
        currentWeek = 'lower';
        scheduleContent.forEach(content => content.innerHTML = '');
        displaySchedule(currentDay);
        lowerWeekButton.classList.add('active');
        upperWeekButton.classList.remove('active');
    }
});

window.addEventListener('DOMContentLoaded', (event) => {
    const links = document.querySelectorAll('a');
    links.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            if (navigator.userAgent.includes('iPhone') || navigator.userAgent.includes('Android')) {
                window.open(link.href, '_system');
            } else {
                window.open(link.href, '_blank');
            }
        });
    });
});

if (today === 0) {
    const currentDayElement = days[6];
    resetActiveDay();
    currentDayElement.classList.add('active');
    currentDay = currentDayElement.dataset.day;
    displaySchedule(currentDay);
} else {
    const currentDayElement = days[today - 1];
    resetActiveDay();
    currentDayElement.classList.add('active');
    currentDay = currentDayElement.dataset.day;
    displaySchedule(currentDay);
}

  const currentTime = new Date();
  const currentHour = currentTime.getHours();
  const currentMinute = currentTime.getMinutes();
  const currentTimeInMinutes = currentHour * 60 + currentMinute;

  const timePeriods = [
    { start: 13 * 60 + 5, end: 14 * 60 + 25 },
    { start: 14 * 60 + 40, end: 16 * 60 },
    { start: 16 * 60 + 20, end: 17 * 60 + 40 },
    { start: 17 * 60 + 55, end: 19 * 60 + 15 }
  ];

  let highlightedIndex = -1;
  for (let i = 0; i < timePeriods.length; i++) {
    const { start, end } = timePeriods[i];
    if (currentTimeInMinutes >= start && currentTimeInMinutes <= end) {
      highlightedIndex = i;
      break;
    }
  }

  if (highlightedIndex !== -1) {
    const timeBarBlocks = document.querySelectorAll('.time-bar-block');
    timeBarBlocks[highlightedIndex].classList.add('current-time');
  }
